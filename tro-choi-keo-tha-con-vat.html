<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tr√≤ ch∆°i K√©o Th·∫£ Con V·∫≠t</title>
    <style>
        body {
            font-family: 'Comic Sans MS', cursive, sans-serif;
            text-align: center;
            background-color: #f0f8ff;
            padding: 20px;
        }
        
        h1 {
            color: #ff6b6b;
            font-size: 28px;
        }
        
        .game-container {
            max-width: 600px;
            margin: 0 auto;
            background-color: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .player-info {
            margin-bottom: 15px;
        }
        
        .player-name {
            font-size: 20px;
            color: #4CAF50;
            font-weight: bold;
        }
        
        .name-input {
            padding: 8px 12px;
            font-size: 16px;
            border: 2px solid #4CAF50;
            border-radius: 5px;
            margin-right: 10px;
        }
        
        .name-submit {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 8px 15px;
            font-size: 16px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .name-submit:hover {
            background-color: #45a049;
        }
        
        .instructions {
            background-color: #fffacd;
            padding: 10px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 18px;
        }
        
        .animals-container {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .animal {
            font-size: 50px;
            margin: 10px;
            cursor: grab;
            transition: transform 0.2s;
        }
        
        .animal:active {
            cursor: grabbing;
            transform: scale(1.2);
        }
        
        .drop-area {
            min-height: 100px;
            border: 3px dashed #aaa;
            border-radius: 10px;
            padding: 10px;
            margin-bottom: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
            background-color: #f9f9f9;
            flex-direction: column;
        }
        
        .drop-area.highlight {
            border-color: #4CAF50;
            background-color: #e8f5e9;
        }
        
        .target-sequence {
            display: flex;
            justify-content: center;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }
        
        .target-animal {
            font-size: 30px;
            margin: 5px;
            opacity: 0.5;
        }
        
        .target-animal.completed {
            opacity: 1;
        }
        
        .user-sequence {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            min-height: 60px;
            width: 100%;
        }
        
        .buttons {
            margin-top: 20px;
        }
        
        button {
            background-color: #4CAF50;
            border: none;
            color: white;
            padding: 10px 15px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            margin: 5px;
            cursor: pointer;
            border-radius: 5px;
            transition: background-color 0.3s;
        }
        
        button:hover {
            background-color: #45a049;
        }
        
        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        
        .feedback {
            font-size: 24px;
            font-weight: bold;
            margin: 15px 0;
            min-height: 30px;
        }
        
        .correct {
            color: #4CAF50;
        }
        
        .wrong {
            color: #f44336;
        }
        
        .level-indicator {
            font-size: 20px;
            color: #ff9800;
            margin-bottom: 10px;
        }
        
        .celebration {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 100;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 100px;
            animation: celebration 2s ease-out;
        }
        
        @keyframes celebration {
            0% { transform: scale(0); opacity: 0; }
            50% { transform: scale(1.5); opacity: 1; }
            100% { transform: scale(1); opacity: 0; }
        }
        
        .welcome-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 200;
        }
        
        .welcome-box {
            background-color: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            text-align: center;
            max-width: 500px;
        }
        
        .welcome-title {
            color: #ff6b6b;
            font-size: 28px;
            margin-bottom: 20px;
        }
        
        .audio-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 10px;
        }
        
        .audio-button {
            background-color: #ff9800;
            color: white;
            border: none;
            padding: 8px 15px;
            margin: 0 5px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
            display: flex;
            align-items: center;
            font-size: 14px;
        }
        
        .audio-button:hover {
            background-color: #f57c00;
        }
        
        .audio-icon {
            margin-right: 5px;
            font-size: 18px;
        }
    </style>
</head>
<body>
    <div class="welcome-screen" id="welcome-screen">
        <div class="welcome-box">
            <h2 class="welcome-title">TR√í CH∆†I K√âO TH·∫¢ CON V·∫¨T</h2>
            <p>Nh·∫≠p t√™n c·ªßa b√© ƒë·ªÉ b·∫Øt ƒë·∫ßu ch∆°i nh√©!</p>
            <input type="text" class="name-input" id="player-name-input" placeholder="T√™n c·ªßa b√©" maxlength="20">
            <button class="name-submit" id="start-game-btn">B·∫Øt ƒë·∫ßu</button>
        </div>
    </div>

    <div class="game-container" id="game-container" style="display: none;">
        <h1>TR√í CH∆†I K√âO TH·∫¢ CON V·∫¨T</h1>
        
        <div class="player-info">
            <span>B√©: </span>
            <span class="player-name" id="player-name-display"></span>
        </div>
        
        <div class="audio-controls">
            <button class="audio-button" id="toggle-music">
                <span class="audio-icon">üéµ</span>
                <span id="music-text">T·∫Øt nh·∫°c</span>
            </button>
            <button class="audio-button" id="toggle-sound">
                <span class="audio-icon">üîä</span>
                <span id="sound-text">T·∫Øt √¢m thanh</span>
            </button>
        </div>
        
        <div class="level-indicator">C·∫•p ƒë·ªô: <span id="level">1</span>/3</div>
        
        <div class="instructions">
            <p>H√£y k√©o c√°c con v·∫≠t theo th·ª© t·ª± b√™n d∆∞·ªõi:</p>
        </div>
        
        <div class="animals-container" id="animals-container">
            <!-- C√°c con v·∫≠t s·∫Ω ƒë∆∞·ª£c th√™m b·∫±ng JavaScript -->
        </div>
        
        <div class="drop-area" id="drop-area">
            <div class="target-sequence" id="target-sequence"></div>
            <div class="user-sequence" id="user-sequence"></div>
        </div>
        
        <div class="feedback" id="feedback"></div>
        
        <div class="buttons">
            <button id="hint-btn">G·ª£i √Ω</button>
            <button id="reset-btn">L√†m l·∫°i</button>
            <button id="next-btn" disabled>Ti·∫øp theo</button>
        </div>
    </div>

    <!-- Audio elements -->
    <audio id="background-music" loop>
        <source src="https://cdn.freesound.org/previews/619/619282_13084319-lq.mp3" type="audio/mpeg">
    </audio>
    
    <audio id="correct-sound">
        <source src="https://cdn.freesound.org/previews/619/619087_12789040-lq.mp3" type="audio/mpeg">
    </audio>
    
    <audio id="wrong-sound">
        <source src="https://cdn.freesound.org/previews/331/331912_3248244-lq.mp3" type="audio/mpeg">
    </audio>
    
    <audio id="level-complete-sound">
        <source src="https://cdn.freesound.org/previews/258/258142_4486188-lq.mp3" type="audio/mpeg">
    </audio>
    
    <audio id="hint-sound">
        <source src="https://cdn.freesound.org/previews/414/414290_8057916-lq.mp3" type="audio/mpeg">
    </audio>

    <script>
        // Danh s√°ch t·∫•t c·∫£ c√°c con v·∫≠t c√≥ th·ªÉ c√≥
        const allAnimals = ['üê∂', 'üê±', 'üê≠', 'üê∞', 'ü¶ä', 'üêª', 'üêº', 'ü¶Å', 'üêÆ', 'üê∑', 'üê∏', 'üêµ'];
        
        // D·ªØ li·ªáu tr√≤ ch∆°i
        const levels = [
            { // C·∫•p ƒë·ªô 1: 2 con v·∫≠t ng·∫´u nhi√™n
                getSequence: function() {
                    // Ch·ªçn ng·∫´u nhi√™n 2 con v·∫≠t kh√°c nhau
                    const shuffled = [...allAnimals].sort(() => Math.random() - 0.5);
                    const sequence = shuffled.slice(0, 2);
                    return {
                        animals: [...sequence].sort(() => Math.random() - 0.5), // X√°o tr·ªôn th·ª© t·ª± hi·ªÉn th·ªã
                        sequence: sequence,
                        instruction: sequence.join(" ‚Üí ")
                    };
                }
            },
            { // C·∫•p ƒë·ªô 2: 3 con v·∫≠t ng·∫´u nhi√™n
                getSequence: function() {
                    const shuffled = [...allAnimals].sort(() => Math.random() - 0.5);
                    const sequence = shuffled.slice(0, 3);
                    return {
                        animals: [...sequence].sort(() => Math.random() - 0.5),
                        sequence: sequence,
                        instruction: sequence.join(" ‚Üí ")
                    };
                }
            },
            { // C·∫•p ƒë·ªô 3: 4 con v·∫≠t ng·∫´u nhi√™n
                getSequence: function() {
                    const shuffled = [...allAnimals].sort(() => Math.random() - 0.5);
                    const sequence = shuffled.slice(0, 4);
                    return {
                        animals: [...sequence].sort(() => Math.random() - 0.5),
                        sequence: sequence,
                        instruction: sequence.join(" ‚Üí ")
                    };
                }
            }
        ];
        
        // Bi·∫øn tr·∫°ng th√°i
        let currentLevel = 0;
        let draggedAnimal = null;
        let droppedAnimals = [];
        let canDrop = true;
        let currentLevelData = null;
        let playerName = "";
        let isMusicOn = true;
        let isSoundOn = true;
        
        // C√°c ph·∫ßn t·ª≠ DOM
        const welcomeScreen = document.getElementById('welcome-screen');
        const gameContainer = document.getElementById('game-container');
        const playerNameInput = document.getElementById('player-name-input');
        const startGameBtn = document.getElementById('start-game-btn');
        const playerNameDisplay = document.getElementById('player-name-display');
        const animalsContainer = document.getElementById('animals-container');
        const dropArea = document.getElementById('drop-area');
        const targetSequence = document.getElementById('target-sequence');
        const userSequence = document.getElementById('user-sequence');
        const feedback = document.getElementById('feedback');
        const levelDisplay = document.getElementById('level');
        const hintBtn = document.getElementById('hint-btn');
        const resetBtn = document.getElementById('reset-btn');
        const nextBtn = document.getElementById('next-btn');
        
        // C√°c ph·∫ßn t·ª≠ audio
        const backgroundMusic = document.getElementById('background-music');
        const correctSound = document.getElementById('correct-sound');
        const wrongSound = document.getElementById('wrong-sound');
        const levelCompleteSound = document.getElementById('level-complete-sound');
        const hintSound = document.getElementById('hint-sound');
        
        // ƒêi·ªÅu khi·ªÉn nh·∫°c v√† √¢m thanh
        const toggleMusicBtn = document.getElementById('toggle-music');
        const toggleSoundBtn = document.getElementById('toggle-sound');
        const musicText = document.getElementById('music-text');
        const soundText = document.getElementById('sound-text');
        
        // ƒêi·ªÅu khi·ªÉn nh·∫°c n·ªÅn
        toggleMusicBtn.addEventListener('click', function() {
            isMusicOn = !isMusicOn;
            if (isMusicOn) {
                backgroundMusic.play();
                musicText.textContent = 'T·∫Øt nh·∫°c';
            } else {
                backgroundMusic.pause();
                musicText.textContent = 'B·∫≠t nh·∫°c';
            }
        });
        
        // ƒêi·ªÅu khi·ªÉn √¢m thanh
        toggleSoundBtn.addEventListener('click', function() {
            isSoundOn = !isSoundOn;
            if (isSoundOn) {
                soundText.textContent = 'T·∫Øt √¢m thanh';
            } else {
                soundText.textContent = 'B·∫≠t √¢m thanh';
            }
        });
        
        // H√†m ch∆°i √¢m thanh
        function playSound(sound) {
            if (isSoundOn) {
                sound.currentTime = 0;
                sound.play();
            }
        }
        
        // B·∫Øt ƒë·∫ßu tr√≤ ch∆°i khi nh·∫≠p t√™n
        startGameBtn.addEventListener('click', function() {
            playerName = playerNameInput.value.trim();
            if (playerName === "") {
                alert("B√© nh·∫≠p t√™n v√†o nh√©!");
                return;
            }
            
            playerNameDisplay.textContent = playerName;
            welcomeScreen.style.display = 'none';
            gameContainer.style.display = 'block';
            
            // B·∫Øt ƒë·∫ßu nh·∫°c n·ªÅn
            if (isMusicOn) {
                backgroundMusic.play();
            }
            
            initGame();
        });
        
        // Cho ph√©p nh·∫•n Enter ƒë·ªÉ b·∫Øt ƒë·∫ßu
        playerNameInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                startGameBtn.click();
            }
        });
        
        // Hi·ªáu ·ª©ng ƒÉn m·ª´ng
        function showCelebration() {
            const celebration = document.createElement('div');
            celebration.className = 'celebration';
            celebration.textContent = 'üéâ';
            document.body.appendChild(celebration);
            
            setTimeout(() => {
                celebration.remove();
            }, 2000);
        }
        
        // Kh·ªüi t·∫°o tr√≤ ch∆°i
        function initGame() {
            droppedAnimals = [];
            canDrop = true;
            feedback.textContent = '';
            nextBtn.disabled = true;
            
            // T·∫°o d·ªØ li·ªáu c·∫•p ƒë·ªô hi·ªán t·∫°i
            currentLevelData = levels[currentLevel].getSequence();
            
            // Hi·ªÉn th·ªã c·∫•p ƒë·ªô hi·ªán t·∫°i
            levelDisplay.textContent = currentLevel + 1;
            
            // Hi·ªÉn th·ªã th·ª© t·ª± m·ª•c ti√™u
            targetSequence.innerHTML = '';
            currentLevelData.sequence.forEach(animal => {
                const animalElement = document.createElement('div');
                animalElement.className = 'target-animal';
                animalElement.textContent = animal;
                targetSequence.appendChild(animalElement);
            });
            
            // X√≥a khu v·ª±c th·∫£ c·ªßa ng∆∞·ªùi d√πng
            userSequence.innerHTML = '';
            
            // T·∫°o c√°c con v·∫≠t c√≥ th·ªÉ k√©o
            animalsContainer.innerHTML = '';
            
            currentLevelData.animals.forEach(animal => {
                const animalElement = document.createElement('div');
                animalElement.className = 'animal';
                animalElement.textContent = animal;
                animalElement.draggable = true;
                
                animalElement.addEventListener('dragstart', function(e) {
                    draggedAnimal = animal;
                    e.dataTransfer.setData('text/plain', animal);
                    setTimeout(() => {
                        animalElement.style.visibility = 'hidden';
                    }, 0);
                });
                
                animalElement.addEventListener('dragend', function() {
                    animalElement.style.visibility = 'visible';
                });
                
                animalsContainer.appendChild(animalElement);
            });
        }
        
        // S·ª± ki·ªán k√©o th·∫£
        dropArea.addEventListener('dragover', function(e) {
            if (canDrop) {
                e.preventDefault();
                dropArea.classList.add('highlight');
            }
        });
        
        dropArea.addEventListener('dragleave', function() {
            dropArea.classList.remove('highlight');
        });
        
        dropArea.addEventListener('drop', function(e) {
            e.preventDefault();
            dropArea.classList.remove('highlight');
            
            if (!canDrop) return;
            
            const animal = e.dataTransfer.getData('text/plain');
            
            // Ki·ªÉm tra xem th·ª© t·ª± c√≥ ƒë√∫ng kh√¥ng
            const expectedAnimal = currentLevelData.sequence[droppedAnimals.length];
            
            if (animal === expectedAnimal) {
                droppedAnimals.push(animal);
                
                // Ph√°t √¢m thanh ƒë√∫ng
                playSound(correctSound);
                
                // Hi·ªÉn th·ªã con v·∫≠t ƒë√£ th·∫£
                const animalElement = document.createElement('span');
                animalElement.className = 'animal';
                animalElement.textContent = animal;
                animalElement.style.margin = '5px';
                userSequence.appendChild(animalElement);
                
                // ƒê√°nh d·∫•u con v·∫≠t ƒë√£ ho√†n th√†nh trong target sequence
                targetSequence.children[droppedAnimals.length - 1].classList.add('completed');
                
                // Ki·ªÉm tra xem ƒë√£ ho√†n th√†nh ch∆∞a
                if (droppedAnimals.length === currentLevelData.sequence.length) {
                    canDrop = false;
                    feedback.textContent = `${playerName} gi·ªèi qu√°! Ch√≠nh x√°c!`;
                    feedback.className = 'feedback correct';
                    nextBtn.disabled = false;
                    showCelebration();
                    
                    // Ph√°t √¢m thanh ho√†n th√†nh c·∫•p ƒë·ªô
                    playSound(levelCompleteSound);
                } else {
                    feedback.textContent = 'ƒê√∫ng r·ªìi! Ti·∫øp theo l√† g√¨ nh·ªâ?';
                    feedback.className = 'feedback correct';
                    setTimeout(() => {
                        feedback.textContent = '';
                    }, 1000);
                }
            } else {
                // Ph√°t √¢m thanh sai
                playSound(wrongSound);
                
                feedback.textContent = 'Ch∆∞a ƒë√∫ng r·ªìi, b√© th·ª≠ l·∫°i nh√©!';
                feedback.className = 'feedback wrong';
                setTimeout(() => {
                    feedback.textContent = '';
                }, 1000);
            }
        });
        
        // N√∫t g·ª£i √Ω
        hintBtn.addEventListener('click', function() {
            if (droppedAnimals.length < currentLevelData.sequence.length) {
                // Ph√°t √¢m thanh g·ª£i √Ω
                playSound(hintSound);
                
                const nextAnimal = currentLevelData.sequence[droppedAnimals.length];
                feedback.textContent = `Con v·∫≠t ti·∫øp theo l√†: ${nextAnimal}`;
                feedback.className = 'feedback correct';
                setTimeout(() => {
                    feedback.textContent = '';
                }, 2000);
            }
        });
        
        // N√∫t l√†m l·∫°i
        resetBtn.addEventListener('click', function() {
            playSound(hintSound);
            initGame();
        });
        
        // N√∫t ti·∫øp theo
        nextBtn.addEventListener('click', function() {
            if (currentLevel < levels.length - 1) {
                currentLevel++;
                playSound(correctSound);
                initGame();
            } else {
                feedback.textContent = `Ch√∫c m·ª´ng ${playerName} ƒë√£ ho√†n th√†nh t·∫•t c·∫£ c√°c c·∫•p ƒë·ªô!`;
                feedback.className = 'feedback correct';
                nextBtn.disabled = true;
                showCelebration();
                playSound(levelCompleteSound);
            }
        });
        
        // X·ª≠ l√Ω l·ªói t·∫£i √¢m thanh
        backgroundMusic.addEventListener('error', function() {
            console.log('Kh√¥ng th·ªÉ t·∫£i nh·∫°c n·ªÅn');
            toggleMusicBtn.disabled = true;
            musicText.textContent = 'Kh√¥ng c√≥ nh·∫°c';
        });
        
        // T·ª± ƒë·ªông t·∫£i l·∫°i √¢m thanh khi ƒë√£ t·∫£i xong metadata
        document.querySelectorAll('audio').forEach(audio => {
            audio.addEventListener('loadedmetadata', function() {
                console.log(`ƒê√£ t·∫£i xong: ${this.id}`);
            });
        });
    </script>
</body>
</html>